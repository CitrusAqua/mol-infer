[日本語](Readme_ja.md)

# Module 1: Calculating Feature Vector from SDF file

Last-updated: November 20th, 2020


Module 1 calculates the *feature vector* (FV) for given chemical compound(s).

## Quick start

One or more compounds can be given by a standard SDF file.
Feature vectors are output in our original FV format (csv style).
These formats are covered by the following sections.

### Generate an FV file from a given SDF file

Compile  
```
g++ -std=c++11 -Wall -O3 -o FV_ec fv_ec.cpp
```
The source files fv_ec.cpp and common.cpp must be placed on the same directory. 


Run  
```
$ ./FV_ec INPUT.sdf OUTPUT.csv
```
The 1st argument INPUT.sdf specifies the input SDF file, and
the 2nd argument OUTPUT.csv specifies the output FV file.
For example, with the provided example,
```
$ ./FV_ec sample1.sdf sample1.csv

$ ./FV_ec sample2.sdf sample2.csv
```
If you run the program without arguments,
or if the arguments are not given appropriately,
then the program outputs how to provide arguments and halts. 

### Generate an FV file from a given SDF file so that the FV file has the same descriptors as other FV file


Compile
```
g++ -std=c++11 -Wall -O3 -o FV_proj fv_proj.cpp
```
The two source files fv_proj.cpp and common.cpp must be placed on the same directory.

Run 
```
$ ./FV_proj DESCRIPTOR.csv INPUT.sdf OUTPUT.csv
```
The 1st argument DESCRIPTOR.csv specifies the input FV file,
the 2nd argument INPUT.sdf specifies the input SDF file, and
the 3rd argument OUTPUT.csv specifies the output FV file.
For example, with the provided example,
```
$ ./FV_proj sample2.csv sample1.sdf sample1_on_2.csv
```
For chemical compounds in sample1.sdf,
the feature vectors under the descriptors used in sample2.csv are output in sample1_on_2.csv. 

If you run the program without arguments,
or if the arguments are not given appropriately,
then the program outputs how to provide arguments and halts. 

### Roles of the two programs
+ FV_ec should be used when you would like to learn a neural network (NN) in Module 2 from INPUT.sdf. The learning script of Module 2 requires the FV file OUTPUT.csv generated by FV_ec.
+ FV_proj should be used when a NN has been constructed from DESCRIPTOR.csv and you would like to predict the target value of each chemical compound in INPUT.sdf by using the NN. The predictor script of Module 2 requires the FV file OUTPUT.csv generated by FV_proj. 


## SDF format

This program uses SDF (Structure Data File), a standard format, for input.
See the official definition http://help.accelrysonline.com/ulm/onelab/1.0/content/ulm_pdfs/direct/reference/ctfileformats2016.pdf for detail.
or, e.g., https://www.chem-station.com/blog/2012/04/sdf.html for an explanation in Japanese.
A sample (sample1.sdf) is attached in this module whose detail can be found from https://pubchem.ncbi.nlm.nih.gov/compound/6140.

## FV format

The output is in an original FV (Feature Vector) format, which is just a CSV file so that can
be opened by Excel and other spreadsheet software.
The first line shows the components of FV and the following lines show the values
for those components of FV.
For example, let us have a look at the FV file sample1.csv that is obtained by running FV_ec for sample1.sdf.
```
CID,n,cs,ch,bl_2,ms,dg_co_1,dg_co_2,dg_co_3,dg_co_4,dg_nc_1,dg_nc_2,dg_nc_3,dg_nc_4,bd_co_2,bd_co_3,bd_in_2,bd_in_3,bd_ex_2,bd_ex_3,ns_co_C3,ns_co_C2,ns_nc_O1,ns_nc_N1,ns_nc_C2,ns_nc_C3,ec_co_C2_C3_2,ec_co_C2_C2_1,ec_co_C2_C3_1,ec_co_C2_C2_2,ec_in_C2_C3_1,ec_in_C3_C2_1,ec_ex_C3_N1_1,ec_ex_C3_C3_1,ec_ex_C3_O1_1,ec_ex_C3_O1_2,nsH
6140,12,6,4,1,128.333,0,5,1,0,3,1,2,0,3,0,0,0,1,0,1,5,2,1,1,2,1,2,1,2,1,1,1,1,1,1,11
```

Overview of the components. See the paper for details. 
+ CID:  CID in PubChem (https://pubchem.ncbi.nlm.nih.gov/). For example, the compound in sample1.sdf is
https://pubchem.ncbi.nlm.nih.gov/compound/6140 (Phenylalanine).
+ n: Number of atoms except for the hydrogen
+ cs: Number of atoms in the core
+ ch: Core height
+ bl: Number of 2-leaves
+ ms: Average molecular mass defined by
![M = \frac{1}{n}\sum_{a}\lfloor 10 \cdot mass(a)\rfloor](https://render.githubusercontent.com/render/math?math=%5Cdisplaystyle+M+%3D+%5Cfrac%7B1%7D%7Bn%7D%5Csum_%7Ba%7D%5Clfloor+10+%5Ccdot+mass%28a%29%5Crfloor)
+ dg_co_1, dg_co_2, dg_co_3, dg_co_4: Number of atoms in the core such that the degree is 1, 2, 3 and 4, resp.
+ dg_nc_1, dg_nc_2, dg_nc_3, dg_nc_4: Number of atoms *not* in the core such that the degree is 1, 2, 3 and 4, resp.
+ bd_co_2, bd_co_3: Number of double and triple bonds in the core paths, resp.
+ bd_in_2, bd_in_3: Number of double and triple bonds in the internal paths, resp.
+ bd_ex_2, bd_ex_3: Number of double and triple bonds in the external paths, resp.
+ ns_co_Xd: Number of atoms in the core such that the element symbol is X and the degree is d. For example, ns_co_C3 represents the number of carbon atoms in the core such that the degree is 3. 
+ ns_nc_Xd: Number of atoms *not* in the core such that the element symbol is X and the degree is d.
+ ec_co_Xx_Yy_2, ec_co_Xx_Yy_3: Number of double and triple bonds in the core paths such that the end nodes have X and Y as element symbols and the degrees x and y, resp. For example, ec_co_C2_C3_2 represents the number of double bonds in the core paths such that both end nodes are carbon atoms and have the degrees 2 and 3, resp. 
+ ec_in_Xx_Yy_2, ec_in_Xx_Yy_3: Number of double and triple bonds in the internal paths such that the end nodes have X and Y as element symbols and the degrees x and y, resp.
+ ec_ex_Xx_Yy_2, ec_ex_Xx_Yy_3: Number of double and triple bonds in the external paths such that the end nodes have X and Y as element symbols and the degrees x and y, resp.
+ nsH: Number of the hydrogen atoms


For the descriptors whose names begin with ns_ and ec_,
only those appearing the INPUT.sdf are written in the OUTPUT.csv. 



## Program notes


1. The main source code of FV_ec is fv_ec.cpp,
while the main source code of FV_proj is fv_proj.cpp.
The functions commonly used in both programs are contained in common.cpp. 
While one compiles an executable program,
these source files must be placed on the same directory. 


2. The mass of each atom is hard-coded in the program.
They are written in the function init_MassMap() in common.cpp as follows.
If one needs to change values or to add another atoms,
edit the source code directly and compile again. 

```
Mass data of atoms used in the program (function init_MassMap())
M["B"]  = 108;
M["C"]  = 120;
M["O"]  = 160;
M["N"]  = 140;
M["F"]  = 190;
M["Si"] = 280;
M["P"]  = 310;
M["S"]  = 320;
M["Cl"] = 355;
M["V"]  = 510;
M["Br"] = 800;
M["Cd"] = 1124;
M["I"]  = 1270;
M["Hg"] = 2006;
M["Pb"] = 2072;
M["Al"] = 269;
```

3. To see verbose output,
change bool debug to true in line 29 of fv_ecc.cpp or
in line 37 of fv_proj.cpp and compile the program again. 
